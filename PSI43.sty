% LaTeX Beamer template for PSI
% currently the format is for 4:3 (and not for the new 16:9) 

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{PSI43}[2021/09/14 1.0.0 PSI Beamer Template 4:3 ratio]

\RequirePackage{microtype}
\RequirePackage[no-math]{fontspec}
\setsansfont[Ligatures=NoCommon]{Calibri}
\definecolor{PSIgray}{rgb}{0.4625,0.4625,0.4625}
\definecolor{PSIlightgray}{rgb}{0.72265625,0.72265625,0.72265625}
\definecolor{PSIverylightgray}{rgb}{0.894,0.894,0.894}
\beamertemplatenavigationsymbolsempty
\useinnertheme{circles}
\setbeamercolor*{item}{fg=black}
%
% Check format: Usage: \ifratio{43}{do}{else}:

\makeatletter%
\newcommand\ifratio[3]{%
\ifnum#1=169%
    \ifdim\beamer@paperwidth=16.00cm\relax%
        \ifdim\beamer@paperheight=9.00cm\relax%
            #2%
        \else%
            #3%
        \fi%
    \else%
        #3%
    \fi%
\else%
    \ifnum#1=43%
        \ifdim\beamer@paperwidth=12.80cm\relax%
            \ifdim\beamer@paperheight=9.60cm\relax%
                #2%
            \else%
                #3%
            \fi%
        \else%
            #3%
        \fi%
    \fi%
\fi%
}
\makeatother%

% The gray square:
\setbeamertemplate{background canvas}{%
  \raisebox{-0.3\paperheight}[0pt][0pt]{%
    \makebox[\paperwidth][l]{\color{PSIlightgray}{\rule{1cm}{1cm}}}}}
% The PSI logo: External file "PSI.pdf"
%% old: \logo{\includegraphics[height=0.4cm]{PSI}\hfill \vspace{.85\paperheight}}
%\logo{\includegraphics[height=0.4cm]{PSI}\hspace*{.89\paperwidth}\hfill \vspace{.836\paperheight}}
% Frametitle:
\newcommand\leftBorder{1.2cm}
\setbeamertemplate{frametitle}[default][left,leftskip=\leftBorder]%
\setbeamerfont{frametitle}{family={\fontspec[Ligatures=TeX]{Georgia}}}
\addtobeamertemplate{frametitle}{\vskip+0.2cm\raisebox{-0.3ex}{\includegraphics[width=2.5em]{PSI}}\hspace*{0em}}{}
\setbeamercolor{frametitle}{fg=PSIgray}
% Text margin:
\setbeamersize{text margin left=\leftBorder}
% Footline:
\setbeamertemplate{footline}{%
  \raisebox{4pt}{\makebox[\paperwidth]
    {\makebox[0.8\paperwidth][l]
      {\tiny \qquad\color{gray}{\insertshortauthor, \insertshortinstitute}}\hfill\makebox[9pt]
      {\scriptsize\color{gray}{\insertframenumber}\ }}}}
% Title of presentation:
\setbeamerfont{title}{family={\fontspec{Georgia}}}
\setbeamerfont{institute}{family={\fontspec{Calibri}}}
% Title page:
\setbeamertemplate{title page}{%
\hspace*{-3cm}%
\color{PSIverylightgray}{\rule{0.4\paperwidth}{5cm}}%
\makebox[0cm]{\hspace*{-0.25\paperwidth}\raisebox{3.6cm}{\includegraphics[width=2cm]{PSI}}}%
\hspace*{0.12cm}%
\ifratio{43}{%
  \includegraphics[height=5cm]{PSIlandscape43WirSchaffenWissen.jpg}}{%
  \includegraphics[height=5cm]{PSIlandscape169WirSchaffenWissen.jpg}}%
%\includegraphics[height=5cm]{\ifratio{43}{PSIlandscape43WirSchaffenWissen.jpg}{PSIlandscape169WirSchaffenWissen.jpg}}%
\hspace*{0.12cm}%
\color{PSIverylightgray}{\rule{0.08\paperwidth}{5cm}}\par%
  \usebeamerfont{institute}{\color{PSIgray}{%
      \textbf{\insertauthor\ :: \insertinstitute}}}%
\par\vspace{1ex}%
\usebeamerfont{title}{\color{PSIgray}{\inserttitle}\par}%
\vspace{1ex}%
\usebeamerfont{institute}{\color{PSIgray}{%
      \insertsubtitle
    }}\par%
\vfill%
\parbox[b][2ex][l]{1cm}{
  \raisebox{1cm}{\color{PSIlightgray}{\rule{1cm}{1cm}}}}
\hfill\usebeamerfont{institute}{\color{PSIgray}{\insertdate}}\hspace{1cm}
}


\newcommand{\PSIfill}{\vskip 0pt plus 1filll}
\newcommand{\PSIvspace}{\ifratio{43}{\vspace*{3.7ex}}{\vspace*{2.8ex}}}

\newcommand*{\PSItrailer}[3][0.4\textwidth]{
  \usebackgroundtemplate{%
\raisebox{-0.3\paperheight}[0pt][0pt]{%
    \makebox[1cm][l]{\color{PSIlightgray}{\rule{1cm}{1cm}}}}%
  \hspace*{0.2cm}%
    \ifratio{43}{%
      \raisebox{-1.01\textheight}{%
        \includegraphics[height=0.83\textheight]{PSIlandscape43.jpg}}}{%
      \raisebox{-1.05\textheight}{%
        \includegraphics[height=0.88\textheight]{PSIlandscape169.jpg}}}%
      }
\setbeamertemplate{footline}{}
\begin{frame}{#2}
  \PSIvspace%
  \pgfsetfillopacity{0.75}{%
     \colorbox{white!20}{%
       \begin{minipage}[t][0.83\textheight][t]{#1}
         #3
         \vfill
       \end{minipage}}}
   \vfill
\end{frame}%
}






% Change the following colors:
\DeclareOption{blockcolored}{%
\setbeamercolor{block body alerted}{bg=alerted text.fg!10}%
\setbeamercolor{block title alerted}{bg=alerted text.fg!20}%
\setbeamercolor{block body}{bg=structure!10}%
\setbeamercolor{block title}{bg=structure!20}%
\setbeamercolor{block body example}{bg=green!10}%
\setbeamercolor{block title example}{bg=green!20}%
}
\DeclareOption{aspectratio=169}{\renewcommand{\PSIvspace}{\vspace*{2ex}}}
\DeclareOption{9pt}{
\setbeamerfont{frametitle}{size=\huge}%
\setbeamerfont{title}{size=\huge}%
\setbeamerfont{institute}{size=\small}%
\setbeamersize{text margin right=0.5cm}%
}
\DeclareOption*{\PackageWarning{PSI43}{Unknown ‘\CurrentOption’}}
\ProcessOptions\relax


